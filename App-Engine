<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>appengine - infra/infra - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.FgwOs7Bvh5E6-lzR-xJuUQ.cache.css"><link rel="stylesheet" type="text/css" href="/+static/doc.aizEIcp0qpW8JIXIrCB9UQ.cache.css"><link rel="stylesheet" type="text/css" href="/+static/prettify/prettify.AOMOBqJIPcDq491E2ExAAw.cache.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://chromium.googlesource.com/login/infra/infra/%2B/master/appengine">Switch user</a> <a class="Header-menuItem" href="https://chromium.googlesource.com/+logout?continue=/infra/infra/%2B/master/appengine">Sign out</a> <span class="Header-menuItem Header-menuItem--noAction">‪M.shaffar sha‬ &lt;m.shaffar19@gmail.com&gt;</span> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">chromium</a> / <a class="Breadcrumbs-crumb" href="/infra/">infra</a> / <a class="Breadcrumbs-crumb" href="/infra/infra/">infra</a> / <a class="Breadcrumbs-crumb" href="/infra/infra/+/master">master</a> / <a class="Breadcrumbs-crumb" href="/infra/infra/+/master/">.</a> / <span class="Breadcrumbs-crumb">appengine</span></div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: ff29677f24a3ff5252a49663e073348281be4aea [<a href="/infra/infra/+log/master/appengine">path history</a>] <span>[<a href="/infra/infra/+archive/master/appengine.tar.gz">tgz</a>]</span></div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - .eslintrc.json"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/.eslintrc.json">.eslintrc.json</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - .gitignore"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/.gitignore">.gitignore</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - PRESUBMIT.py"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/PRESUBMIT.py">PRESUBMIT.py</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - README.md"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/README.md">README.md</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - bugdroid/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/bugdroid/">bugdroid/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - chromium_bugs/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/chromium_bugs/">chromium_bugs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - chromium_build/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/chromium_build/">chromium_build/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - chromium_committers/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/chromium_committers/">chromium_committers/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - chromium_cq_status/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/chromium_cq_status/">chromium_cq_status/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - chromium_rietveld/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/chromium_rietveld/">chromium_rietveld/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - chromium_status/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/chromium_status/">chromium_status/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cr-buildbucket/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/cr-buildbucket/">cr-buildbucket/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cr_rev/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/cr_rev/">cr_rev/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - experimental/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/experimental/">experimental/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - findit/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/findit/">findit/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - js_checker.py"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/js_checker.py">js_checker.py</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - monorail/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/monorail/">monorail/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - p2_test_revert_and_reland.txt"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/p2_test_revert_and_reland.txt">p2_test_revert_and_reland.txt</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - package-lock.json"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/package-lock.json">package-lock.json</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - package.json"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/package.json">package.json</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - predator/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/predator/">predator/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - third_party/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/third_party/">third_party/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - ui_catalogue/"><a class="FileList-itemLink" href="/infra/infra/+/master/appengine/ui_catalogue/">ui_catalogue/</a></li></ol><div class="InlineReadme"><div class="InlineReadme-path">appengine/README.md</div><div class="doc"><h1><a class="h" name="appengine" href="#appengine"><span></span></a>appengine/</h1><p>This directory contains appengine applications, one per subdirectory (the testing framework relies on this assumption to list all tests). To be consistent with appengine principles, each of these directories must contain everything it needs to work. Code shared between several applications should live in <code class="code">appengine_modules/</code> and be symlinked into each application directory that needs it.</p><h1><a class="h" name="Creating-an-appengine-application" href="#Creating-an-appengine-application"><span></span></a><a class="h" name="creating-an-appengine-application" href="#creating-an-appengine-application"><span></span></a>Creating an appengine application</h1><h2><a class="h" name="TL_DR" href="#TL_DR"><span></span></a><a class="h" name="tl_dr" href="#tl_dr"><span></span></a>TL;DR</h2><p>Create a new Appengine app by running <code class="code">run.py infra.tools.new_app &lt;app_name&gt;</code>.</p><p>The script will create a minimal structure of a working Appengine app in infra.git:</p><ul><li>an app directory under <code class="code">appengine/</code>, say <code class="code">appengine/myapp</code></li><li><code class="code">appengine/myapp/app.yaml</code></li><li><code class="code">appengine/myapp/main.py</code> implements a trivial public endpoint.</li><li><code class="code">appengine/myapp/.expect_tests_pretest.py</code> is a symlink pointing at <code class="code">appengine_modules/expect_tests_pretest.py</code>. This is required for testing, see below.</li><li><code class="code">appengine/myapp/.expect_tests.cfg</code> lists any third-party components that should be skipped by tests.</li><li><code class="code">appengine/myapp/components</code> (optional) points at <code class="code">luci/appengine/components/components</code>. Most infra apps require authentication, and components/auth is our standard. Delete this link if your app does not use it, and edit <code class="code">.expect_tests.cfg</code> appropriately.</li><li><code class="code">appengine/myapp/gae.py</code> points at <code class="code">luci/appengine/components/tools/gae.py</code> (optional), a handy script for deploying and managing your app.</li><li><code class="code">appengine/myapp/test/main_test.py</code> (optional, but highly recommended) tests for main.py.</li></ul><p>Example: the myapp application should live in <code class="code">appengine/myapp</code>. To use <code class="code">appengine_module/testing_utils</code>, create a symlink to it in <code class="code">appengine/myapp/testing_utils</code>. The name should remain the same as Python relies on directory names for its import system.</p><div class="note"><p>Note: symbolic links do not work on Managed VMs. A workaround is to create a temporary deployment directory:</p><pre class="code">rsync -L -r appengine/myapp /tmp/deploy_myapp
pushd /tmp/deploy_myapp/myapp
&lt;deploy your app here&gt;
</pre></div><h1><a class="h" name="AppEngine-Modules" href="#AppEngine-Modules"><span></span></a><a class="h" name="appengine-modules" href="#appengine-modules"><span></span></a>AppEngine Modules</h1><p>The default module is configured in <code class="code">app.yaml</code>. Any non-default module must be configured in <code class="code">module-&lt;module_name&gt;.yaml</code>.  This is how the <code class="code">gae.py</code> script will know you what modules you have.</p><h2><a class="h" name="Testing" href="#Testing"><span></span></a><a class="h" name="testing" href="#testing"><span></span></a>Testing</h2><p>Tests included in AppEngine applications (classes deriving from <code class="code">unittest.TestCase</code>) are run by <code class="code">test.py</code>. Some convenience functions to help using the testbed server are included in <a href="appengine_modules/testing_utils">appengine_modules/testing_utils</a>. Some examples can be found in existing applications, and a simple test setup is also provided by the <code class="code">infra.tools.new_app</code> script.</p><p>See <a href="doc/testing.md">Testing in infra.git</a> for more details. In particular, it&#39;s important to have a test file <code class="code">tests/foo_test.py</code> for every source file <code class="code">foo.py</code>.</p><div class="note">Note: for test code to be able to import modules from the AE SDK (e.g. <code class="code">endpoints</code>), some manipulation of <code class="code">sys.path</code> has to be done by <code class="code">test.py</code>. This manipulation has to be performed in an <code class="code">.expect_tests_pretest.py</code> file located at the root of the appengine app, with the content of <code class="code">appengine_module/expect_tests_pretest.py</code>. <strong>Adding a symlink to that file should be enough for 99.99% of cases.</strong> (and yes, it&#39;s very hacky, we know).</div><h2><a class="h" name="Managing-AppEngine-apps" href="#Managing-AppEngine-apps"><span></span></a><a class="h" name="managing-appengine-apps" href="#managing-appengine-apps"><span></span></a>Managing AppEngine apps</h2><p>A convenience script wrapping <code class="code">appcfg.py</code> called <code class="code">gae.py</code> can be used to simplify and normalize the deployment process in <code class="code">infra.git</code>. Just add a symlink to it in your application as <code class="code">gae.py</code>. It is located in <code class="code">luci/appengine/components/tools/gae.py</code>:</p><pre class="code">cd myproject
ln -s gae.py ../../../luci/appengine/components/tools/gae.py
</pre><p>Run <code class="code">gae.py --help</code> to see what gae.py can do.</p></div></div></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>
